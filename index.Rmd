---
title: "A comparison of motivation playlists"
author: "Tessa Vermeulen"
date: 'February 2022'
output:
  flexdashboard::flex_dashboard:
    storyboard: true
    theme: cerulean
    self_contained: false
---

```{r setup}
library(ggplot2)
library(dplyr)
library(tidyverse)
library(tidymodels)
library(plotly) # N.B. Requires the Cairo package
library(protoclust)
library(heatmaply)
library(spotifyr)
library(compmus)

```

### Self-similarity matrix of Shivers from Ed Sheeran (timbre)

```{r self-sim}
shivers <-
  get_tidy_audio_analysis("50nfwKoDiSYg8zOCREWAm5") %>% # Change URI.
  compmus_align(bars, segments) %>%                     # Change `bars`
  select(bars) %>%                                      #   in all three
  unnest(bars) %>%                                      #   of these lines.
  mutate(
    pitches =
      map(segments,
          compmus_summarise, pitches,
          method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  ) %>%
  mutate(
    timbre =
      map(segments,
          compmus_summarise, timbre,
          method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  )

ed_sheeran <- 
  shivers %>%
    compmus_self_similarity(timbre, "euclidean") %>% 
    ggplot(
      aes(
        x = xstart + xduration / 2,
        width = xduration,
        y = ystart + yduration / 2,
        height = yduration,
        fill = d
      )
    ) +
    geom_tile() +
    coord_fixed() +
    scale_fill_viridis_c(guide = "none") +
    theme_classic() +
    labs(x = "", y = "")


ggplotly(ed_sheeran)

```

***
The song Shivers from Ed Sheeran is one of the songs in my personal playlist. This song falls under the Pop genre. Most pop songs contain an intro, verses, pre-chorus and chorus. 
With a self-similarity matrix, we can determine which sections of a song more or less have the same timbre, or same overall sound, and which sections are different. 
When looking closely at the plot, we can see two diagonal lines off the main diagonal. This means that a section of the song has been repeated. In pop songs, this is usually an indication of a repetition of the chorus.

* plot mooier opmaken
* plot verder analyseren

### Introduction 

This corpus compares different motivation playlists that people listen to before a race.
I have changed the subject of my portfolio so I have to start all over again. 


### pitch chromatogram
```{r pitch_chromatogram}
# Leas on life andy grammer
andy_grammer <-
  get_tidy_audio_analysis("4ufkuONjQMNR2fyXu1bO9w") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)

#all I do is win dj Khaled
dj_khaled <-
  get_tidy_audio_analysis("12PNcnMsjsZ3eHm62t8hiy") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)

both <- 
  bind_rows(
    andy_grammer %>% mutate(category = "Andy Grammer - Leas on life"),
    dj_khaled %>% mutate(category = "DJ Khaled - All I do is win")
  )

pitch <- 
  both %>%
    mutate(pitches = map(pitches, compmus_normalise, "euclidean")) %>%
    compmus_gather_chroma() %>% 
    ggplot(
      aes(
        x = start + duration / 2,
        width = duration,
        y = pitch_class,
        fill = value
      )
    ) +
    geom_tile() +
    labs(x = "Time (s)", y = NULL, fill = "angular") +
    theme_minimal() +
    facet_wrap(~category)




ggplotly(pitch)

```



### Conclusion 

Still working on the conclusion 